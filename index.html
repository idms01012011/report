<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Service Report</title>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600&display=swap" rel="stylesheet" />
<link rel="icon" href="logo.png" type="image/png">
<style>
  body {
    font-family: 'Kanit', sans-serif;
    padding: 0;
    margin: 0;
    background: linear-gradient(135deg, #dbeafe 0%, #f0f4f8 100%);
    min-height: 100vh;
  }
  header {
    background: linear-gradient(90deg, #1767b2 0%, #2fa7e2 100%);
    color: #fff;
    padding: 28px 0 20px 0;
    text-align: center;
    letter-spacing: 1px;
    box-shadow: 0 2px 12px #1767b233;
  }
  header img {
    width: 54px;
    margin-bottom: 6px;
    filter: drop-shadow(0 2px 8px #fff7);
  }
  header h1 {
    margin: 7px 0 0 0;
    font-size: 2.15rem;
    font-weight: 700;
    letter-spacing: 1.5px;
  }
  .container {
    max-width: 700px;
    margin: 36px auto 32px auto;
    background: rgba(255,255,255,0.99);
    border-radius: 18px;
    box-shadow: 0 10px 32px 0 rgba(30,100,180,0.13), 0 2px 6px 0 rgba(30,100,180,0.11);
    padding: 36px 30px 30px 30px;
    animation: fadein 1s;
  }
  @keyframes fadein {
    from { opacity: 0; transform: translateY(25px);}
    to { opacity: 1; transform: translateY(0);}
  }
  h2 {
    margin: 0 0 22px 0;
    font-size: 1.45rem;
    font-weight: 600;
    text-align: center;
    color: #1767b2;
    letter-spacing: 1px;
  }
  form {
    padding: 0;
    margin: 0 0 26px 0;
  }
  label {
    margin-top: 18px;
    font-size: 1.07rem;
    font-weight: 500;
    color: #1767b2;
    display: block;
    transition: color .2s;
  }
  input, select, textarea {
    margin-top: 7px;
    margin-bottom: 2px;
    font-size: 1rem;
    padding: 10px 12px;
    border: 1.7px solid #b2b8c2;
    border-radius: 7px;
    background: #f8faff;
    width: 100%;
    box-sizing: border-box;
    transition: border-color 0.22s, background 0.22s, box-shadow 0.14s;
    outline: none;
  }
  input:focus, select:focus, textarea:focus {
    border-color: #2fa7e2;
    background: #eaf6ff;
    box-shadow: 0 2px 10px #2fa7e244;
  }
  textarea {
    resize: vertical;
    min-height: 50px;
  }
  .image-preview-grid {
    display: flex;
    gap: 16px;
    margin-top: 10px;
    flex-wrap: wrap;
    justify-content: flex-start;
  }
  .image-preview-grid img {
    width: 120px;
    height: 90px;
    object-fit: cover;
    border: 1.5px solid #b2b8c2;
    border-radius: 9px;
    background: #fff;
    box-shadow: 0 3px 12px #b2c5e6a3;
    transition: transform .2s;
  }
  .image-preview-grid img:hover {
    transform: scale(1.05) rotate(-2deg);
    border-color: #2fa7e2;
  }
  .signature-container {
    margin: 18px 0 18px 0;
    background: #f7fbff;
    border-radius: 8px;
    padding: 14px 12px 12px 12px;
    box-shadow: 0 1px 4px #b2c5e65c;
  }
  .signature-container label {
    color: #2d3d6b;
    font-weight: 600;
    margin-bottom: 7px;
    font-size: 1.08rem;
  }
  canvas {
    border: 1.5px solid #b2b8c2;
    background: #fff;
    border-radius: 7px;
    margin-bottom: 8px;
    width: 100%;
    max-width: 320px;
    height: 80px;
    display: block;
    box-shadow: 0 1px 6px #2fa7e233;
  }
  button[type="button"] {
    background: #fff;
    color: #1767b2;
    border: 1.3px solid #1767b2;
    border-radius: 5px;
    padding: 6px 22px;
    cursor: pointer;
    font-size: 1rem;
    margin-top: 0;
    margin-bottom: 6px;
    transition: background 0.18s, color 0.18s, border 0.19s;
  }
  button[type="button"]:hover {
    background: #1767b2;
    color: #fff;
    border-color: #2fa7e2;
  }
  button[type="submit"] {
    background: linear-gradient(90deg, #1767b2 0%, #2fa7e2 100%);
    color: #fff;
    border: none;
    border-radius: 9px;
    padding: 15px 0;
    font-size: 1.13rem;
    font-weight: 700;
    margin-top: 28px;
    width: 100%;
    cursor: pointer;
    box-shadow: 0 5px 18px #1767b222;
    letter-spacing: 1px;
    transition: background 0.2s, box-shadow 0.18s;
  }
  button[type="submit"]:hover {
    background: linear-gradient(90deg, #1560a6 0%, #23a0db 100%);
    box-shadow: 0 2px 14px #1767b244;
  }
  #content {
    font-family: 'Kanit', sans-serif;
    font-size: 14px;
    color: #000;
    padding: 0;
    margin: 0;
    width: 180mm;
    background: white;
    box-sizing: border-box;
  }
  footer {
    text-align: center;
    color: #2fa7e2;
    font-size: 1rem;
    margin: 24px 0 10px 0;
    letter-spacing: 0.5px;
    opacity: 0.6;
    padding-bottom: 10px;
  }
  /* Responsive for mobile */
  @media (max-width: 700px) {
    .container { max-width: 99vw; padding: 5vw 1vw 5vw 1vw; }
    #content { width: 99vw; max-width: 99vw;}
    .image-preview-grid img { width: 90px; height: 68px; }
    h2 { font-size: 1.13rem;}
    header { padding: 16px 0 14px 0;}
    header h1 { font-size: 1.25rem;}
  }
</style>
</head>
<body>
  <script>
    // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ login
    if (localStorage.getItem("isLoggedIn") !== "true") {
      window.location.href = "login.html";  // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤ login ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    }
  </script>
  <header>
    <img src="logo.png" alt="Logo">
    <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Service Report</h1>
    <div style="font-size:1.08rem;opacity:.9;font-weight:400;margin-top:3px;">
      <span style="vertical-align:middle;">IDMS COMPANY LIMITED</span>
    </div>
  </header>
  <div class="container">
    <h2>
      <span style="color:#2fa7e2;margin-right:7px;">üìù</span>
      ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Service Report
    </h2>
    <form id="reportForm">
      <label>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:<input type="text" id="customerName" required placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤..."></label>
      <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô:
        <select id="jobType" required>
          <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô --</option>
          <option value="Service">Service</option>
          <option value="Preventive Maintenance">Preventive Maintenance</option>
          <option value="Calibration">Calibration</option>
          <option value="Other">Other</option>
        </select>
      </label>
      <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á:<input type="text" id="deviceName" required placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á..."></label>
      <label>‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠:<input type="text" id="brand" required placeholder="‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠..."></label>
      <label>‡∏£‡∏∏‡πà‡∏ô:<input type="text" id="model" required placeholder="‡∏£‡∏∏‡πà‡∏ô..."></label>
      <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå:<input type="text" id="assetNumber" required placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå..."></label>
      <label>Serial Number:<input type="text" id="serialNumber" required placeholder="Serial Number..."></label>
      <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô:<textarea id="serviceDetails" rows="4" required placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥..."></textarea></label>
      <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:<input type="date" id="serviceDate" required></label>
      <label>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û:
        <input type="file" id="imageInput" accept="image/*" multiple>
        <div class="image-preview-grid" id="imagePreview"></div>
      </label>
      <div class="signature-container">
        <label>‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó:</label>
        <canvas id="sig1" width="320" height="80"></canvas>
        <button type="button" onclick="clearCanvas(event,'sig1')">‡∏•‡πâ‡∏≤‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ó‡∏µ‡πà 1</button>
      </div>
      <div class="signature-container">
        <label>‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</label>
        <canvas id="sig2" width="320" height="80"></canvas>
        <button type="button" onclick="clearCanvas(event,'sig2')">‡∏•‡πâ‡∏≤‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ó‡∏µ‡πà 2</button>
      </div>
      <button type="submit">‡∏™‡∏£‡πâ‡∏≤‡∏á PDF</button>
    </form>
    <div id="content" style="display:none;"></div>
  </div>
  <footer>
    ¬© 2025 IDMS COMPANY LIMITED | Service Report System
  </footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  const { jsPDF } = window.jspdf;

  let imageDataUrls = [];
  document.getElementById('imageInput').addEventListener('change', e => {
    const files = e.target.files;
    const imagePreview = document.getElementById('imagePreview');
    imagePreview.innerHTML = '';

    if (files.length > 2) {
      alert('‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 2 ‡∏£‡∏π‡∏õ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
      e.target.value = '';
      imageDataUrls = [];
      return;
    }
    imageDataUrls = [];
    Array.from(files).forEach(file => {
      const reader = new FileReader();
      reader.onload = function(evt) {
        imageDataUrls.push(evt.target.result);
        // ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
        const img = document.createElement('img');
        img.src = evt.target.result;
        imagePreview.appendChild(img);
      };
      reader.readAsDataURL(file);
    });
  });

  document.getElementById('reportForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const name = document.getElementById('customerName').value;
    const jobType = document.getElementById('jobType').value;
    const deviceName = document.getElementById('deviceName').value;
    const brand = document.getElementById('brand').value;
    const model = document.getElementById('model').value;
    const assetNumber = document.getElementById('assetNumber').value;
    const serialNumber = document.getElementById('serialNumber').value;
    const details = document.getElementById('serviceDetails').value.replace(/\n/g, '<br>');
    const date = document.getElementById('serviceDate').value;
    const sig1 = document.getElementById('sig1');
    const sig2 = document.getElementById('sig2');
    const sig1DataUrl = sig1.toDataURL('image/png');
    const sig2DataUrl = sig2.toDataURL('image/png');

    let htmlContent = `
      <div style="
        position: relative;
        padding: 0mm 15mm 15mm 15mm;
        margin: 0;
        width: 180mm;
        background:#fff;
        box-sizing: border-box;
        font-family: 'Kanit', sans-serif;
      ">
        <img src="logo.png"
          style="position: absolute; top: 15mm; left: 15mm; width: 30mm; height: auto; object-fit: contain;" 
          alt="Company Logo" />
        <div style="text-align:center; line-height:1.2; margin-bottom:10px;">
          <strong style="font-size:16px;">IDMS COMPANY LIMITED</strong><br>
          126/101, Moo 4 T.Bang Larmung A.Bang Lamung Chon Buri 20150<br>
          Tel. 081-998-8372 | E-Mail: IDMS2@hotmail.com
        </div>
        <h2 style="margin:0 0 10px 0; padding:0;">Service Report</h2>
        <hr style="margin:10px 0;">
        <div style="margin-bottom:10px;">
          <div style="display: flex; justify-content: space-between; gap: 10px;">
            <div style="width: 50%;"><strong>Customer Name:</strong> ${name}</div>
            <div style="width: 50%;"><strong>Job Type:</strong> ${jobType}</div>
          </div>
          <div style="margin-top: 5px;">
            <strong>Service Date:</strong> ${date}
          </div>
        </div>
        <hr style="margin:10px 0;">
        <div style="margin-bottom:10px;">
          <strong>Device Information:</strong><br>
          <div style="display: flex; gap: 10px; justify-content: space-between;">
            <div style="width: 50%;">- Device Name: ${deviceName}</div>
            <div style="width: 50%;">- Brand: ${brand}</div>
          </div>
          <div style="display: flex; gap: 10px; justify-content: space-between; margin-top: 5px;">
            <div style="width: 50%;">- Model: ${model}</div>
            <div style="width: 50%;">- Asset Number: ${assetNumber}</div>
          </div>
          <div style="margin-top: 5px;">- Serial Number: ${serialNumber}</div>
        </div>
        <hr style="margin:10px 0;">
        <div style="margin-bottom:10px;">
          <strong>Service Details:</strong><br>
          <div style="margin-left:10px;">${details}</div>
        </div>
        ${imageDataUrls.length > 0 ? `
          <hr style="margin:10px 0;">
          <div>
            <strong>Attached Images:</strong>
            <div style="display: flex; justify-content: center; gap: 20px; margin-top: 10px;">
              ${imageDataUrls.slice(0, 2).map(src => `
                <img src="${src}" style="max-width: 45%; max-height: 200px; object-fit: contain;" />
              `).join('')}
            </div>
          </div>
        ` : ''}
      </div>
      <hr style="margin:10px 0;">
      <div style="display: flex; justify-content: center; gap: 50px; align-items: center;">
        <div style="text-align: center;">
          <strong>‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</strong><br>
          <img src="${sig1DataUrl}" style="width: 180px; height: 60px; border: 1px solid #000; object-fit: contain;" />
        </div>
        <div style="text-align: center;">
          <strong>‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</strong><br>
          <img src="${sig2DataUrl}" style="width: 180px; height: 60px; border: 1px solid #000; object-fit: contain;" />
        </div>
      </div>
    `;

    const container = document.getElementById('content');
    container.innerHTML = htmlContent;
    container.style.display = 'block';

    // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏†‡∏≤‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏°‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏±‡∏ö‡∏†‡∏≤‡∏û
    await new Promise(resolve => setTimeout(resolve, 800));
    const canvas = await html2canvas(container, {
      scale: 2,
      useCORS: true,
      scrollY: -window.scrollY,
      windowWidth: document.documentElement.offsetWidth
    });

    const imgData = canvas.toDataURL('image/jpeg', 1.0);
    const pdf = new jsPDF({ unit: 'mm', format: 'a4' });
    const pdfWidth = 180;
    const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
    pdf.addImage(imgData, 'JPEG', 15, 15, pdfWidth, pdfHeight);
    pdf.save(`Service_Report_${name}_${date}.pdf`);
    container.style.display = 'none';
  });

  function resizeCanvasToDisplaySize(canvas) {
    const rect = canvas.getBoundingClientRect();
    canvas.width = rect.width;
    canvas.height = rect.height;
  }

  function setupSignatureCanvas(canvasId) {
    const canvas = document.getElementById(canvasId);
    const ctx = canvas.getContext('2d');
    resizeCanvasToDisplaySize(canvas);
    ctx.lineWidth = 2;
    ctx.strokeStyle = "#1767b2";
    let drawing = false;

    function getPointerPos(evt) {
      const rect = canvas.getBoundingClientRect();
      let x, y;
      if (evt.touches && evt.touches.length > 0) {
        x = evt.touches[0].clientX - rect.left;
        y = evt.touches[0].clientY - rect.top;
      } else {
        x = evt.clientX - rect.left;
        y = evt.clientY - rect.top;
      }
      return {x, y};
    }

    canvas.addEventListener('mousedown', (e) => {
      drawing = true;
      const pos = getPointerPos(e);
      ctx.beginPath();
      ctx.moveTo(pos.x, pos.y);
    });
    canvas.addEventListener('mousemove', (e) => {
      if (!drawing) return;
      const pos = getPointerPos(e);
      ctx.lineTo(pos.x, pos.y);
      ctx.stroke();
    });
    canvas.addEventListener('mouseup', () => drawing = false);
    canvas.addEventListener('mouseout', () => drawing = false);

    canvas.addEventListener('touchstart', (e) => {
      e.preventDefault();
      drawing = true;
      const pos = getPointerPos(e);
      ctx.beginPath();
      ctx.moveTo(pos.x, pos.y);
    }, { passive: false });
    canvas.addEventListener('touchmove', (e) => {
      e.preventDefault();
      if (!drawing) return;
      const pos = getPointerPos(e);
      ctx.lineTo(pos.x, pos.y);
      ctx.stroke();
    }, { passive: false });
    canvas.addEventListener('touchend', (e) => {
      e.preventDefault();
      drawing = false;
    }, { passive: false });
  }
  function clearCanvas(event, canvasId) {
    event.preventDefault();
    const canvas = document.getElementById(canvasId);
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }
  setupSignatureCanvas('sig1');
  setupSignatureCanvas('sig2');
</script>
</body>
</html>
